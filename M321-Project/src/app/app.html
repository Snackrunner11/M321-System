<div class="app-container">
  
  <div *ngIf="isDevMode" class="dev-banner">
    âš ï¸ DEVELOPMENT ENVIRONMENT âš ï¸
  </div>

<header>
    <h1 class="title">Pixelboard</h1>
    <div class="meta-info">
      <span class="status-label">â±ï¸ Ladezeit:</span>
      <span class="time-badge" [ngClass]="{'fast': loadingTime < 50, 'slow': loadingTime > 200}">
        {{ loadingTime }} ms
      </span>
      
      <span class="status-indicator" 
            [style.color]="socket && socket.connected ? '#00ff88' : '#ff3333'">
          {{ socket && socket.connected ? 'ğŸŸ¢ Live' : 'ğŸ”´ Offline' }}
      </span>
    </div>
  </header>
  
  <div *ngIf="errorMessage" class="error-banner">
    ğŸš¨ {{ errorMessage }}
  </div>
  
  <div *ngIf="successMessage" class="success-banner">
    âœ… {{ successMessage }}
  </div>

  <main>
    <div class="control-panel card-entrance user-section">
      <h3>ğŸ‘¤ Account & Team</h3>
      
      <div *ngIf="!userClaims">
        <button (click)="oauthService.initLoginFlow()" class="btn-login">
          ğŸ”‘ Login mit Keycloak
        </button>
      </div>

      <div *ngIf="userClaims">
        <p class="user-info-text"><strong>Keycloak ID:</strong> {{ userClaims['preferred_username'] }}</p>
        <p class="user-info-text"><strong>Team Claim:</strong> {{ userClaims['team'] || 'Kein Team' }}</p>
        
        <div class="registration-area">
            <h4>Registrierung (Einmalig)</h4>
            
            <div class="reg-row">
                <input #gamerTagInput placeholder="Dein Gamer Tag" class="input-text">
                <button (click)="registerPlayer(gamerTagInput.value)" class="btn-action">
                  Spieler Registrieren
                </button>
            </div>

            <div class="reg-row">
                <input #teamNameInput placeholder="Neuer Team Name" class="input-text">
                <button (click)="registerTeam(teamNameInput.value)" class="btn-action">
                  Team Registrieren
                </button>
            </div>
        </div>
      </div>
    </div>

    <div class="control-panel card-entrance">
      <div class="brush-display">
        <span class="label">Aktueller Pinsel:</span>
        <div class="brush-preview" [style.background-color]="currentBrushColor">
          {{ selectedTeam.Name || 'Lade...' }}
        </div>
      </div>
      <div class="instructions">
        <span>ğŸ–±ï¸ Links: Malen</span> | <span>ğŸ–±ï¸ Rechts: Team wechseln</span>
      </div>
    </div>

    <div class="board-wrapper card-entrance" *ngIf="board.length > 0">
      <div class="board-grid" (contextmenu)="onRightClick($event)">
        <div *ngFor="let row of board; index as y" class="board-row">
          <div *ngFor="let pixel of row; index as x" 
               class="pixel"
               (click)="onLeftClick(x, y)"
               [style.background-color]="'rgb(' + (pixel.Red||pixel.r||0) + ',' + (pixel.Green||pixel.g||0) + ',' + (pixel.Blue||pixel.b||0) + ')'">
          </div>
        </div>
      </div>
    </div>
    
    <div *ngIf="board.length === 0" class="loading-state">
      <div class="spinner"></div><p>Lade Daten...</p>
    </div>
  </main>
</div>